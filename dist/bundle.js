(()=>{"use strict";var t=function(){function t(t){var i=this;this.free=!0,this.elm=document.createElement("audio"),this.elm.src=t,this.elm.style.display="none",this.elm.setAttribute("preload","auto"),this.elm.setAttribute("controls","none"),this.elm.volume,document.body.appendChild(this.elm),this.elm.onended=function(){i.free=!0}}return t.prototype.play=function(t){this.elm.volume=t,this.elm.play()},t}(),i=new(function(){function i(i,e){this.buffer=[];for(var n=0;n<e;n++)this.buffer.push(new t(i))}return i.prototype.play=function(t){for(var i=0;i<this.buffer.length;i++)if(this.buffer[i].free)return void this.buffer[i].play(t)},i}())("hit.mp3",16);const e=function(){function t(i,e){var n=this;void 0===i&&(i=0),void 0===e&&(e=0),this.copy=function(){return new t(n.x,n.y)},this.magnitude=function(){return Math.sqrt(Math.pow(n.x,2)+Math.pow(n.y,2))},this.multiplyScalor=function(i){return new t(n.x*i,n.y*i)},this.add=function(i){return new t(n.x+i.x,n.y+i.y)},this.sub=function(i){return new t(n.x-i.x,n.y-i.y)},this.normalize=function(){return n.multiplyScalor(1/n.magnitude())},this.toAngle=function(t){return void 0===t&&(t=n.normalize()),Math.atan2(t.x,t.y)},this.rotateByVec=function(t){return n.rotate(t.toAngle())},this.rotate=function(i){var e=Math.sin(i),o=Math.cos(i);return new t(n.x*o-n.y*e,n.x*e+n.y*o)},this.x=i,this.y=e}return t.copy=function(i){return new t(i.x,i.y)},t.dotProduct=function(t,i){return t.x*i.x+t.y*i.y},t.dist=function(i,e){return new t(i.x-e.x,i.y-e.y).magnitude()},t}();var n,o=function(){function t(t,i){this.radius=i,this.pos=t}return t.isColliding=function(t,i){var n=t.radius+i.radius;return!(Math.abs(t.pos.x-i.pos.x)>n||Math.abs(t.pos.y-i.pos.y)>n||e.dist(t.pos,i.pos)>n)},t}(),s=(n=function(t,i){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])})(t,i)},function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function e(){this.constructor=t}n(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)});const r=function(t){function n(i){var o,s,r,a,l,c=t.call(this,i,2.85)||this;return c._isDrawable=!0,c._isBall=!0,c.vol=new e(0,0),c.mass=.15,c.radius=2.85,c.active=!0,c.friction=.0436,c.damping=.99,c.id=n.getId(),c.sprite=(o=c.id,s=["#E9E8CD","#FFD707","#1E6D9D","#FF3501","#7141A3","#FC900A","#50A323","#760602","#313131","#FFD707","#1E6D9D","#FF3501","#7141A3","#FC900A","#50A323","#760602"][o],l='<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t<style>\n    .small { font: bold 12px serif }\n  </style>\n<g filter="url(#filter0_ii)">\n<mask id="mask0" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="32" height="32">\n<circle cx="16" cy="16" r="16" fill="#000"/></mask><g mask="url(#mask0)">\n<circle cx="16" cy="16" r="16" fill="'+(o>8?"#E9E8CD":s)+'"/>\n<g filter="url(#filter1_d)">\n'+((r=o)>=8?'<rect y="8" width="32" height="16" fill="'+s+'"/>':"")+'\n</g>\n<g filter="url(#filter2_d)">\n'+(r?'<circle cx="16" cy="16" r="7.5" fill="#E9E8CD"/>':"")+'\n</g></g></g>\n<g filter="url(#filter3_d)">\n<text id="ball_number" class="small" x="16" y="20" fill="black" text-anchor="middle" alignment-baselin="middle">'+(r||"")+'</text>\n</g><defs>\n<filter id="filter0_ii" x="0" y="-3" width="32" height="36" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">\n<feFlood flood-opacity="0" result="BackgroundImageFix"/>\n<feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>\n<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dy="-4"/>\n<feGaussianBlur stdDeviation="1.5"/><feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1"/>\n<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>\n<feBlend mode="normal" in2="shape" result="effect1_innerShadow"/>\n<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>\n<feOffset dy="1"/><feGaussianBlur stdDeviation="0.5"/><feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1"/>\n<feColorMatrix type="matrix" values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.5 0"/>\n<feBlend mode="normal" in2="effect1_innerShadow" result="effect2_innerShadow"/></filter>\n<filter id="filter1_d" x="0" y="8" width="32.2" height="16.2" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">\n<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dx="0.2" dy="0.2"/>\n<feComposite in2="hardAlpha" operator="out"/>\n<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>\n<feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/>\n<feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/></filter>\n<filter id="filter2_d" x="8.5" y="8.5" width="15.2" height="15.2" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">\n<feFlood flood-opacity="0" result="BackgroundImageFix"/>\n<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>\n<feOffset dx="0.2" dy="0.2"/><feComposite in2="hardAlpha" operator="out"/>\n<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>\n<feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/>\n<feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/></filter>\n<filter id="filter3_d" x="10.7442" y="11.7789" width="11.0936" height="8.42109" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">\n<feFlood flood-opacity="0" result="BackgroundImageFix"/>\n<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dx="0.2" dy="0.2"/>\n<feComposite in2="hardAlpha" operator="out"/>\n<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>\n<feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/>\n<feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/>\n</filter>\n</defs>\n</svg>\n',(a=document.createElement("img")).src="data:image/svg+xml;base64,"+window.btoa(l),a),c.pos=i,c.vol=new e(0,0),c}return s(n,t),n.applyCollison=function(t,e){var n=t.pos.sub(e.pos).normalize(),o=t.pos.sub(e.pos).magnitude();e.pos=e.pos.add(n.multiplyScalor(o-(t.radius+e.radius))),t.pos=t.pos.add(n.multiplyScalor(-(o-(t.radius+e.radius))));var s,r=2*(t.vol.x*n.x+t.vol.y*n.y-(e.vol.x*n.x+e.vol.y*n.y))/(t.mass+e.mass);r*=t.damping*e.damping,s=(s=Math.abs(r))<=1?s:1,i.play(s),t.vol=t.vol.add(n.multiplyScalor(e.mass*-r)),e.vol=e.vol.add(n.multiplyScalor(t.mass*r))},n.applyStaticCollision=function(t,i){var e=t.pos.sub(i.pos).normalize(),n=t.pos.sub(i.pos).magnitude();t.pos=t.pos.add(e.multiplyScalor(-(n-(t.radius+i.radius))));var o=t.vol.x*e.x+t.vol.y*e.y;t.vol=t.vol.add(e.multiplyScalor(-o))},n.prototype.step=function(t){this.pos=this.pos.add(this.vol.multiplyScalor(t)),this.vol=this.vol.multiplyScalor(1-t*this.friction)},n.prototype.draw=function(t){var i=this.pos.x-this.radius,e=this.pos.y-this.radius,n=2*this.radius,o=2*this.radius;t.drawImage(this.sprite,i,e,n,o)},n.current_id=0,n.getId=function(){return n.current_id++},n}(o);var a=function(){var t=function(i,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])})(i,e)};return function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),l=function(t){function i(i){var n=t.call(this)||this;return n._isCue=!0,n.max_dist=40,n.click=function(t){n.ballClicked(t)&&(n.selected=!0,n.updateMousePos(t),document.addEventListener("mousemove",n.updateMousePos),document.addEventListener("mouseup",n.release))},n.ballClicked=function(t){return e.dist(n.ball.pos,n.clickToWorld(t))<n.ball.radius},n.clickToWorld=function(t){var i=n.table.canvas.offsetLeft,o=n.table.canvas.offsetTop;return new e((t.clientX-i)/n.table.canvas_scale-n.table.width/2,(t.clientY-o)/n.table.canvas_scale-n.table.height/2)},n.release=function(t){if(document.removeEventListener("mousemove",n.updateMousePos),document.removeEventListener("mouseup",n.release),n.selected){var i=n.ball.pos.sub(n.mousePos),e=i.normalize(),o=i.magnitude();o>n.max_dist&&(o=n.max_dist),n.ball.vol=e.multiplyScalor(o),n.selected=!1}},n.updateMousePos=function(t){n.mousePos=n.clickToWorld(t)},n.mousePos=new e(0,0),n.ball=i.balls[0],n.selected=!1,n.table=i,n.sprite=document.createElement("img"),n.setup(),n}return a(i,t),i.prototype.setup=function(){this.sprite.src="../assets/cue.svg",this.table.canvas.addEventListener("mousedown",this.click)},i.prototype.draw=function(t){if(this.selected){var i=this.ball.pos.sub(this.mousePos),e=i.normalize().multiplyScalor(-1),n=i.magnitude();n>this.max_dist&&(n=this.max_dist);var o=Math.atan2(e.y,e.x);t.translate(this.ball.pos.x,this.ball.pos.y),t.rotate(o),t.drawImage(this.sprite,n,-2),t.rotate(-o),t.translate(-this.ball.pos.x,-this.ball.pos.y)}},i}((function(){this._isDrawable=!0})),c=function(){function t(t){var i=this;this.canvas_scale=8,this.balls=[],this.colliders=[],this.walls=[],this.drawables=[],this.collision_buffer=[],this.inner_width=224,this.inner_height=112,this.width=240,this.height=128,this.canvas=t,this.ctx=t.getContext("2d"),t.width=this.width*this.canvas_scale,t.height=this.height*this.canvas_scale,this.addObject(new r(new e(0,0))),this.makeBallTriangle(),this.addObject(new l(this)),this.ctx.transform(1,0,0,1,this.width/2,this.height/2),window.onresize=function(){return i.fitToWindow()},this.fitToWindow()}return t.prototype.addObject=function(t){t._isDrawable&&this.drawables.push(t),t._isBall&&this.balls.push(t),t._isWall&&this.walls.push(t),t._isStaticCollider&&this.colliders.push(t)},t.prototype.draw=function(){var t=this;this.ctx.scale(this.canvas_scale,this.canvas_scale),this.ctx.clearRect(-this.width/2,-this.height/2,this.width,this.height),this.drawables.forEach((function(i){return i.draw(t.ctx)})),this.ctx.scale(1/this.canvas_scale,1/this.canvas_scale)},t.prototype.fitToWindow=function(){window.innerWidth,window.innerHeight,window.innerWidth/window.innerHeight>2?this.canvas_scale=window.innerHeight/this.height:this.canvas_scale=window.innerWidth/this.width;var t=this.height*this.canvas_scale,i=this.width*this.canvas_scale;this.canvas.width=i,this.canvas.height=t,this.ctx.translate(this.canvas.width/2,this.canvas.height/2)},t.prototype.makeBallTriangle=function(){for(var t=5,i=0;i<5;i++){for(var n=t;n>0;n--)this.addObject(new r(new e(6*i-60,6*n+3*i-18)));t-=1}},t.prototype.step=function(t){var i=this;this.balls.forEach((function(t){i.walls.forEach((function(i){i.isColliding(t)&&i.applyCollision(t)}))})),this.findCollisions(),this.processCollisions(),this.balls.forEach((function(t){i.colliders.forEach((function(i){o.isColliding(t,i)&&r.applyStaticCollision(t,i)}))})),this.balls.forEach((function(i){return i.step(t)}))},t.prototype.findCollisions=function(){var t=this,i={};this.balls.forEach((function(e){i[e.id]=[],t.balls.forEach((function(n){var s,r;e.id!=n.id&&o.isColliding(e,n)&&((null===(s=i[e.id])||void 0===s?void 0:s.includes(n.id))||(null===(r=i[n.id])||void 0===r?void 0:r.includes(e.id))||(t.collision_buffer.push([e,n]),i[e.id].push(n.id)))}))}))},t.prototype.processCollisions=function(){this.collision_buffer.forEach((function(t){r.applyCollison(t[0],t[1])})),this.collision_buffer=[]},t}(),u=function(){var t=function(i,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])})(i,e)};return function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),h=function(t){function i(i,e){var n=t.call(this,i,e)||this;return n._isStaticCollider=!0,n}return u(i,t),i.prototype.draw=function(t){t.beginPath(),t.arc(this.pos.x,this.pos.y,this.radius,0,2*Math.PI),t.stroke()},i}(o),d=function(){function t(t,i){this._isWall=!0,this.color="black",this.p1=t,this.p2=i,this.mid=this.p1.sub(this.p1.sub(this.p2).multiplyScalor(.5)),this.normal=t.sub(i).normalize().rotate(-90*Math.PI/180)}return t.prototype.getNormal=function(){return this.normal},t.prototype.draw=function(t){t.beginPath(),t.moveTo(this.p1.x,this.p1.y),t.lineTo(this.p2.x,this.p2.y),t.strokeStyle=this.color;var i=this.mid.add(this.normal.multiplyScalor(5));t.moveTo(this.mid.x,this.mid.y),t.lineTo(i.x,i.y),t.stroke(),t.strokeStyle="black"},t.prototype.isColliding=function(t){var i=t.pos.sub(this.mid),e=this.p1.sub(this.mid),n=this.p2.sub(this.mid);return i=i.rotateByVec(this.normal),e=e.rotateByVec(this.normal),n=n.rotateByVec(this.normal),!(i.y-t.radius>0||i.x+t.radius<e.x||i.x-t.radius>n.x)},t.prototype.applyCollision=function(t){var i=t.pos.sub(this.mid);i=i.rotateByVec(this.normal),t.pos.add(this.normal.multiplyScalor(i.y)),t.vol=t.vol.sub(this.normal.multiplyScalor(2*e.dotProduct(t.vol,this.normal)))},t}(),f=new c(document.querySelector("canvas"));f.draw(),f.findCollisions();var p=[new e(8,59),new e(-8,59),new e(8,-59),new e(-8,-59),new e(105,59),new e(115,50),new e(-105,-59),new e(-115,-50),new e(105,-59),new e(115,-50),new e(-105,59),new e(-115,50)];[new d(new e(-112,50),new e(-112,-50)),new d(new e(112,-50),new e(112,50)),new d(new e(8,-56),new e(105,-56)),new d(new e(-105,-56),new e(-8,-56)),new d(new e(105,56),new e(8,56)),new d(new e(-8,56),new e(-105,56))].forEach((function(t){f.addObject(t)})),p.forEach((function(t){f.addObject(new h(t,2.85))})),setInterval((function(){for(var t=0;t<8;t++)f.step(.05)}),8),setInterval((function(){f.draw()}),16)})();