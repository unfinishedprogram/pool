(()=>{"use strict";var t=function(){function t(t){var e=this;this.free=!0,this.elm=document.createElement("audio"),this.elm.src=t,this.elm.style.display="none",this.elm.setAttribute("preload","auto"),this.elm.setAttribute("controls","none"),this.elm.volume,document.body.appendChild(this.elm),this.elm.onended=function(){e.free=!0}}return t.prototype.play=function(t){this.elm.volume=t,this.elm.play()},t}(),e=new(function(){function e(e,i){this.buffer=[];for(var n=0;n<i;n++)this.buffer.push(new t(e))}return e.prototype.play=function(t){for(var e=0;e<this.buffer.length;e++)if(this.buffer[e].free)return void this.buffer[e].play(t)},e}())("hit.mp3",16);var i=function(){this._isDrawable=!0};const n=function(){function t(e,i){var n=this;void 0===e&&(e=0),void 0===i&&(i=0),this.copy=function(){return new t(n.x,n.y)},this.magnitude=function(){return Math.sqrt(Math.pow(n.x,2)+Math.pow(n.y,2))},this.multiplyScalor=function(e){return new t(n.x*e,n.y*e)},this.add=function(e){return new t(n.x+e.x,n.y+e.y)},this.sub=function(e){return new t(n.x-e.x,n.y-e.y)},this.normalize=function(){return n.multiplyScalor(1/n.magnitude())},this.toAngle=function(t){return void 0===t&&(t=n.normalize()),Math.atan2(t.y,t.x)},this.rotateByVec=function(t){return n.rotate(t.toAngle())},this.rotate=function(e,i,o){return void 0===i&&(i=Math.sin(e)),void 0===o&&(o=Math.cos(e)),new t(n.x*o-n.y*i,n.x*i+n.y*o)},this.x=e,this.y=i}return t.copy=function(e){return new t(e.x,e.y)},t.dotProduct=function(e,i){return new t(e.x*i.x,e.y*i.y)},t.dist=function(e,i){return new t(e.x-i.x,e.y-i.y).magnitude()},t}();var o,r=(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});const s=function(t){function i(e){var o,r,s,a,l,c=t.call(this)||this;return c._isBall=!0,c.vol=new n(0,0),c.mass=.15,c.radius=2.85,c.active=!0,c.friction=.0436,c.damping=.99,c.id=i.getId(),c.sprite=(o=c.id,r=["#E9E8CD","#FFD707","#1E6D9D","#FF3501","#7141A3","#FC900A","#50A323","#760602","#313131","#FFD707","#1E6D9D","#FF3501","#7141A3","#FC900A","#50A323","#760602"][o],l='<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t<style>\n    .small { font: bold 12px serif }\n  </style>\n<g filter="url(#filter0_ii)">\n<mask id="mask0" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="32" height="32">\n<circle cx="16" cy="16" r="16" fill="#000"/></mask><g mask="url(#mask0)">\n<circle cx="16" cy="16" r="16" fill="'+(o>8?"#E9E8CD":r)+'"/>\n<g filter="url(#filter1_d)">\n'+((s=o)>=8?'<rect y="8" width="32" height="16" fill="'+r+'"/>':"")+'\n</g>\n<g filter="url(#filter2_d)">\n'+(s?'<circle cx="16" cy="16" r="7.5" fill="#E9E8CD"/>':"")+'\n</g></g></g>\n<g filter="url(#filter3_d)">\n<text id="ball_number" class="small" x="16" y="20" fill="black" text-anchor="middle" alignment-baselin="middle">'+(s||"")+'</text>\n</g><defs>\n<filter id="filter0_ii" x="0" y="-3" width="32" height="36" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">\n<feFlood flood-opacity="0" result="BackgroundImageFix"/>\n<feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>\n<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dy="-4"/>\n<feGaussianBlur stdDeviation="1.5"/><feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1"/>\n<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>\n<feBlend mode="normal" in2="shape" result="effect1_innerShadow"/>\n<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>\n<feOffset dy="1"/><feGaussianBlur stdDeviation="0.5"/><feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1"/>\n<feColorMatrix type="matrix" values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.5 0"/>\n<feBlend mode="normal" in2="effect1_innerShadow" result="effect2_innerShadow"/></filter>\n<filter id="filter1_d" x="0" y="8" width="32.2" height="16.2" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">\n<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dx="0.2" dy="0.2"/>\n<feComposite in2="hardAlpha" operator="out"/>\n<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>\n<feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/>\n<feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/></filter>\n<filter id="filter2_d" x="8.5" y="8.5" width="15.2" height="15.2" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">\n<feFlood flood-opacity="0" result="BackgroundImageFix"/>\n<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>\n<feOffset dx="0.2" dy="0.2"/><feComposite in2="hardAlpha" operator="out"/>\n<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>\n<feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/>\n<feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/></filter>\n<filter id="filter3_d" x="10.7442" y="11.7789" width="11.0936" height="8.42109" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">\n<feFlood flood-opacity="0" result="BackgroundImageFix"/>\n<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dx="0.2" dy="0.2"/>\n<feComposite in2="hardAlpha" operator="out"/>\n<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>\n<feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/>\n<feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/>\n</filter>\n</defs>\n</svg>\n',(a=document.createElement("img")).src="data:image/svg+xml;base64,"+window.btoa(l),a),c.pos=e,c.vol=new n(0,0),c}return r(i,t),i.applyCollison=function(t,i){var n=t.pos.sub(i.pos).normalize(),o=t.pos.sub(i.pos).magnitude();i.pos=i.pos.add(n.multiplyScalor(o-(t.radius+i.radius))),t.pos=t.pos.add(n.multiplyScalor(-(o-(t.radius+i.radius))));var r,s=2*(t.vol.x*n.x+t.vol.y*n.y-(i.vol.x*n.x+i.vol.y*n.y))/(t.mass+i.mass);s*=t.damping*i.damping,r=(r=Math.abs(s))<=1?r:1,e.play(r),t.vol=t.vol.add(n.multiplyScalor(i.mass*-s)),i.vol=i.vol.add(n.multiplyScalor(t.mass*s))},i.applyStaticCollision=function(t,e){var i=t.pos.sub(e.pos).normalize(),n=t.pos.sub(e.pos).magnitude();t.pos=t.pos.add(i.multiplyScalor(-(n-(t.radius+e.radius))));var o=t.vol.x*i.x+t.vol.y*i.y;t.vol=t.vol.add(i.multiplyScalor(-o))},i.applyWallCollision=function(t,e){t.vol=t.vol.rotateByVec(e.getNormal()).multiplyScalor(-1),t.vol=t.vol.rotateByVec(new n(1,1))},i.prototype.step=function(t){this.pos=this.pos.add(this.vol.multiplyScalor(t)),this.vol=this.vol.multiplyScalor(1-t*this.friction)},i.prototype.draw=function(t){var e=this.pos.x-this.radius,i=this.pos.y-this.radius,n=2*this.radius,o=2*this.radius;t.drawImage(this.sprite,e,i,n,o)},i.current_id=0,i.getId=function(){return i.current_id++},i}(i);var a=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),l=function(t){function e(e){var i=t.call(this)||this;return i._isCue=!0,i.max_dist=40,i.click=function(t){i.ballClicked(t)&&(i.selected=!0,i.updateMousePos(t),document.addEventListener("mousemove",i.updateMousePos),document.addEventListener("mouseup",i.release))},i.ballClicked=function(t){return n.dist(i.ball.pos,i.clickToWorld(t))<i.ball.radius},i.clickToWorld=function(t){var e=i.table.canvas.offsetLeft,o=i.table.canvas.offsetTop;return new n((t.clientX-e)/i.table.canvas_scale-i.table.width/2,(t.clientY-o)/i.table.canvas_scale-i.table.height/2)},i.release=function(t){if(document.removeEventListener("mousemove",i.updateMousePos),document.removeEventListener("mouseup",i.release),i.selected){var e=i.ball.pos.sub(i.mousePos),n=e.normalize(),o=e.magnitude();o>i.max_dist&&(o=i.max_dist),i.ball.vol=n.multiplyScalor(o),i.selected=!1}},i.updateMousePos=function(t){i.mousePos=i.clickToWorld(t)},i.mousePos=new n(0,0),i.ball=e.balls[0],i.selected=!1,i.table=e,i.sprite=document.createElement("img"),i.setup(),i}return a(e,t),e.prototype.setup=function(){this.sprite.src="../assets/cue.svg",this.table.canvas.addEventListener("mousedown",this.click)},e.prototype.draw=function(t){if(this.selected){var e=this.ball.pos.sub(this.mousePos),i=e.normalize().multiplyScalor(-1),n=e.magnitude();n>this.max_dist&&(n=this.max_dist);var o=Math.atan2(i.y,i.x);t.translate(this.ball.pos.x,this.ball.pos.y),t.rotate(o),t.drawImage(this.sprite,n,-2),t.rotate(-o),t.translate(-this.ball.pos.x,-this.ball.pos.y)}},e}(i),c=function(){function t(t){var e=this;this.canvas_scale=8,this.balls=[],this.colliders=[],this.walls=[],this.drawables=[],this.collision_buffer=[],this.inner_width=224,this.inner_height=112,this.width=240,this.height=128,this.canvas=t,this.ctx=t.getContext("2d"),t.width=this.width*this.canvas_scale,t.height=this.height*this.canvas_scale,this.addObject(new s(new n(0,0))),this.makeBallTriangle(),this.addObject(new l(this)),this.ctx.transform(1,0,0,1,this.width/2,this.height/2),window.onresize=function(){return e.fitToWindow()},this.fitToWindow()}return t.prototype.addObject=function(t){t._isDrawable&&this.drawables.push(t),t._isBall&&this.balls.push(t),t._isWall&&this.walls.push(t),t._isStaticCollider&&this.colliders.push(t)},t.prototype.draw=function(){var t=this;this.ctx.scale(this.canvas_scale,this.canvas_scale),this.ctx.clearRect(-this.width/2,-this.height/2,this.width,this.height),this.drawables.forEach((function(e){return e.draw(t.ctx)})),this.ctx.scale(1/this.canvas_scale,1/this.canvas_scale)},t.prototype.fitToWindow=function(){window.innerWidth,window.innerHeight,window.innerWidth/window.innerHeight>2?this.canvas_scale=window.innerHeight/this.height:this.canvas_scale=window.innerWidth/this.width;var t=this.height*this.canvas_scale,e=this.width*this.canvas_scale;this.canvas.width=e,this.canvas.height=t,this.ctx.translate(this.canvas.width/2,this.canvas.height/2)},t.prototype.makeBallTriangle=function(){for(var t=5,e=0;e<5;e++){for(var i=t;i>0;i--)this.addObject(new s(new n(6*e-60,6*i+3*e-18)));t-=1}},t.prototype.step=function(t){var e=this;this.inner_width,this.inner_height,this.balls.forEach((function(t){e.walls.forEach((function(e){e.isColliding(t)&&s.applyWallCollision(t,e)}))})),this.findCollisions(),this.processCollisions(),this.balls.forEach((function(t){e.colliders.forEach((function(i){e.isColliding(t,i)&&s.applyStaticCollision(t,i)}))})),this.balls.forEach((function(e){return e.step(t)}))},t.prototype.isColliding=function(t,e){var i=t.radius+e.radius;return!(Math.abs(t.pos.x-e.pos.x)>i||Math.abs(t.pos.y-e.pos.y)>i||n.dist(t.pos,e.pos)>i)},t.prototype.findCollisions=function(){var t=this,e={};this.balls.forEach((function(i){e[i.id]=[],t.balls.forEach((function(n){var o,r;i.id!=n.id&&t.isColliding(i,n)&&((null===(o=e[i.id])||void 0===o?void 0:o.includes(n.id))||(null===(r=e[n.id])||void 0===r?void 0:r.includes(i.id))||(t.collision_buffer.push([i,n]),e[i.id].push(n.id)))}))}))},t.prototype.processCollisions=function(){this.collision_buffer.forEach((function(t){s.applyCollison(t[0],t[1])})),this.collision_buffer=[]},t}(),u=function(){function t(t,e){this.pos=t,this.radius=e}return t.prototype.draw=function(t){t.beginPath(),t.arc(this.pos.x,this.pos.y,this.radius,0,2*Math.PI),t.stroke()},t}(),h=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),d=function(t){function e(e,i){var n,o=t.call(this)||this;return o._isWall=!0,o.color="black",o.p1=e,o.p2=i,o.mid=o.p1.sub(o.p1.sub(o.p2).multiplyScalor(.5)),o.normal=e.sub(i).normalize(),n=[o.normal.y,-o.normal.x],o.normal.x=n[0],o.normal.y=n[1],console.log(o.normal),console.log(o.p1.sub(o.mid).rotateByVec(o.normal),o.p2.sub(o.mid).rotateByVec(o.normal)),o}return h(e,t),e.prototype.getNormal=function(){return this.normal},e.prototype.draw=function(t){t.beginPath(),t.moveTo(this.p1.x,this.p1.y),t.lineTo(this.p2.x,this.p2.y),t.strokeStyle=this.color;var e=this.mid.add(this.normal.multiplyScalor(2));t.moveTo(this.mid.x,this.mid.y),t.lineTo(e.x,e.y),t.stroke(),t.strokeStyle="black"},e.prototype.isColliding=function(t){var e=t.pos.sub(this.mid),i=this.p1.sub(this.mid),n=this.p2.sub(this.mid);return e=e.rotateByVec(this.normal),i=i.rotateByVec(this.normal),n=n.rotateByVec(this.normal),e.x+t.radius>i.y&&!(e.x<i.x-t.radius)&&!(e.x>n.x+t.radius)},e}(i),p=new c(document.querySelector("canvas"));p.draw(),p.findCollisions();var f=[new n(8,59),new n(-8,59),new n(8,-59),new n(-8,-59),new n(105,59),new n(115,50),new n(-105,-59),new n(-115,-50),new n(105,-59),new n(115,-50),new n(-105,59),new n(-115,50)];[new d(new n(-112,50),new n(-112,-50)),new d(new n(112,-50),new n(112,50)),new d(new n(8,-56),new n(105,-56)),new d(new n(-105,-56),new n(-8,-56)),new d(new n(105,56),new n(8,56)),new d(new n(-8,56),new n(-105,56))].forEach((function(t){p.addObject(t)})),f.forEach((function(t){p.addObject(new u(t,2.85))})),setInterval((function(){for(var t=0;t<8;t++)p.step(.05)}),8),setInterval((function(){p.draw()}),16)})();