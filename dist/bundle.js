(()=>{"use strict";var t=function(){function t(t){var i=this;this.free=!0,this.elm=document.createElement("audio"),this.elm.src=t,this.elm.style.display="none",this.elm.setAttribute("preload","auto"),this.elm.setAttribute("controls","none"),this.elm.volume,document.body.appendChild(this.elm),this.elm.onended=function(){i.free=!0}}return t.prototype.play=function(t){this.elm.volume=t,this.elm.play()},t}(),i=new(function(){function i(i,e){this.buffer=[];for(var s=0;s<e;s++)this.buffer.push(new t(i))}return i.prototype.play=function(t){for(var i=0;i<this.buffer.length;i++)if(this.buffer[i].free)return void this.buffer[i].play(t)},i}())("hit.mp3",16);const e=function(){function t(i,e){var s=this;this.x=0,this.y=0,this.magnitude=function(){return Math.sqrt(Math.pow(s.x,2)+Math.pow(s.y,2))},this.multiplyScalor=function(i){return new t(s.x*i,s.y*i)},this.copy=function(){return new t(s.x,s.y)},this.add=function(i){return new t(s.x+i.x,s.y+i.y)},this.sub=function(i){return new t(s.x-i.x,s.y-i.y)},this.normalize=function(){return s.multiplyScalor(1/s.magnitude())},this.toAngle=function(t){return void 0===t&&(t=s.normalize()),Math.atan2(t.y,t.x)},this.rotateByVec=function(t){return s.rotate(t.toAngle())},this.rotate=function(i,e,n){return void 0===e&&(e=Math.sin(i)),void 0===n&&(n=Math.cos(i)),new t(s.x*n-s.y*e,s.x*e+s.y*n)},this.x=i,this.y=e}return t.dotProduct=function(i,e){return new t(i.x*e.x,i.y*e.y)},t.copy=function(i){return new t(i.x,i.y)},t.dist=function(i,e){return new t(i.x-e.x,i.y-e.y).magnitude()},t}(),s=function(){function t(i){var s,n,o,a,l;this.vol=new e(0,0),this.mass=.15,this.radius=2.85,this.active=!0,this.friction=.0436,this.damping=.99,this.id=t.getId(),this.sprite=(s=this.id,n=["#E9E8CD","#FFD707","#1E6D9D","#FF3501","#7141A3","#FC900A","#50A323","#760602","#313131","#FFD707","#1E6D9D","#FF3501","#7141A3","#FC900A","#50A323","#760602"][s],l='<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t<style>\n    .small { font: bold 12px serif }\n  </style>\n<g filter="url(#filter0_ii)">\n<mask id="mask0" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="32" height="32">\n<circle cx="16" cy="16" r="16" fill="#000"/></mask><g mask="url(#mask0)">\n<circle cx="16" cy="16" r="16" fill="'+(s>8?"#E9E8CD":n)+'"/>\n<g filter="url(#filter1_d)">\n'+((o=s)>=8?'<rect y="8" width="32" height="16" fill="'+n+'"/>':"")+'\n</g>\n<g filter="url(#filter2_d)">\n'+(o?'<circle cx="16" cy="16" r="7.5" fill="#E9E8CD"/>':"")+'\n</g></g></g>\n<g filter="url(#filter3_d)">\n<text id="ball_number" class="small" x="16" y="20" fill="black" text-anchor="middle" alignment-baselin="middle">'+(o||"")+'</text>\n</g><defs>\n<filter id="filter0_ii" x="0" y="-3" width="32" height="36" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">\n<feFlood flood-opacity="0" result="BackgroundImageFix"/>\n<feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>\n<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dy="-4"/>\n<feGaussianBlur stdDeviation="1.5"/><feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1"/>\n<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>\n<feBlend mode="normal" in2="shape" result="effect1_innerShadow"/>\n<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>\n<feOffset dy="1"/><feGaussianBlur stdDeviation="0.5"/><feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1"/>\n<feColorMatrix type="matrix" values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.5 0"/>\n<feBlend mode="normal" in2="effect1_innerShadow" result="effect2_innerShadow"/></filter>\n<filter id="filter1_d" x="0" y="8" width="32.2" height="16.2" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">\n<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dx="0.2" dy="0.2"/>\n<feComposite in2="hardAlpha" operator="out"/>\n<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>\n<feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/>\n<feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/></filter>\n<filter id="filter2_d" x="8.5" y="8.5" width="15.2" height="15.2" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">\n<feFlood flood-opacity="0" result="BackgroundImageFix"/>\n<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>\n<feOffset dx="0.2" dy="0.2"/><feComposite in2="hardAlpha" operator="out"/>\n<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>\n<feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/>\n<feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/></filter>\n<filter id="filter3_d" x="10.7442" y="11.7789" width="11.0936" height="8.42109" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">\n<feFlood flood-opacity="0" result="BackgroundImageFix"/>\n<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dx="0.2" dy="0.2"/>\n<feComposite in2="hardAlpha" operator="out"/>\n<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>\n<feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/>\n<feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/>\n</filter>\n</defs>\n</svg>\n',(a=document.createElement("img")).src="data:image/svg+xml;base64,"+window.btoa(l),a),this.pos=i,this.vol=new e(0,0)}return t.applyCollison=function(t,e){var s=t.pos.sub(e.pos).normalize(),n=t.pos.sub(e.pos).magnitude();e.pos=e.pos.add(s.multiplyScalor(n-(t.radius+e.radius))),t.pos=t.pos.add(s.multiplyScalor(-(n-(t.radius+e.radius))));var o,a=2*(t.vol.x*s.x+t.vol.y*s.y-(e.vol.x*s.x+e.vol.y*s.y))/(t.mass+e.mass);a*=t.damping*e.damping,o=(o=Math.abs(a))<=1?o:1,i.play(o),t.vol=t.vol.add(s.multiplyScalor(e.mass*-a)),e.vol=e.vol.add(s.multiplyScalor(t.mass*a))},t.applyStaticCollision=function(t,i){var e=t.pos.sub(i.pos).normalize(),s=t.pos.sub(i.pos).magnitude();t.pos=t.pos.add(e.multiplyScalor(-(s-(t.radius+i.radius))));var n=t.vol.x*e.x+t.vol.y*e.y;t.vol=t.vol.add(e.multiplyScalor(-n))},t.applyWallCollision=function(t,i){t.vol=t.vol.rotateByVec(i.getNormal()).multiplyScalor(-1),t.vol=t.vol.rotateByVec(new e(1,1))},t.prototype.step=function(t){this.pos=this.pos.add(this.vol.multiplyScalor(t)),this.vol=this.vol.multiplyScalor(1-t*this.friction)},t.prototype.draw=function(t){var i=this.pos.x-this.radius,e=this.pos.y-this.radius,s=2*this.radius,n=2*this.radius;t.drawImage(this.sprite,i,e,s,n)},t.current_id=0,t.getId=function(){return t.current_id++},t}();var n=function(){function t(t){var i=this;this.max_dist=40,this.click=function(t){i.ballClicked(t)&&(i.selected=!0,i.updateMousePos(t),document.addEventListener("mousemove",i.updateMousePos),document.addEventListener("mouseup",i.release))},this.ballClicked=function(t){return e.dist(i.ball.pos,i.clickToWorld(t))<i.ball.radius},this.clickToWorld=function(t){var s=i.table.canvas.offsetLeft,n=i.table.canvas.offsetTop;return new e((t.clientX-s)/i.table.canvas_scale-i.table.width/2,(t.clientY-n)/i.table.canvas_scale-i.table.height/2)},this.release=function(t){if(document.removeEventListener("mousemove",i.updateMousePos),document.removeEventListener("mouseup",i.release),i.selected&&!i.ballClicked(t)){var e=i.ball.pos.sub(i.mousePos),s=e.normalize(),n=e.magnitude();n>i.max_dist&&(n=i.max_dist),i.ball.vol=s.multiplyScalor(n),i.selected=!1}},this.updateMousePos=function(t){i.mousePos=i.clickToWorld(t)},this.mousePos=new e(0,0),this.ball=t.balls[0],this.selected=!1,this.table=t,this.sprite=document.createElement("img"),this.setup()}return t.prototype.setup=function(){this.sprite.src="../cue.svg",this.table.canvas.addEventListener("mousedown",this.click)},t.prototype.draw=function(t){if(this.selected){var i=this.ball.pos.sub(this.mousePos),e=i.normalize().multiplyScalor(-1),s=i.magnitude();s>this.max_dist&&(s=this.max_dist);var n=Math.atan2(e.y,e.x);t.translate(this.ball.pos.x,this.ball.pos.y),t.rotate(n),t.drawImage(this.sprite,s,-2),t.rotate(-n),t.translate(-this.ball.pos.x,-this.ball.pos.y)}},t}(),o=function(){function t(t){var i=this;this.canvas_scale=8,this.balls=[],this.colliders=[],this.walls=[],this.collision_buffer=[],this.inner_width=224,this.inner_height=112,this.width=240,this.height=128,this.canvas=t,this.ctx=t.getContext("2d"),t.width=this.width*this.canvas_scale,t.height=this.height*this.canvas_scale,this.addBall(new s(new e(0,0))),this.makeBallTriangle(),this.cue=new n(this),this.ctx.transform(1,0,0,1,this.width/2,this.height/2),window.onresize=function(){return i.fitToWindow()},this.fitToWindow()}return t.prototype.addBall=function(t){this.balls.push(t)},t.prototype.addCollider=function(t){this.colliders.push(t)},t.prototype.addWall=function(t){this.walls.push(t)},t.prototype.draw=function(){var t=this;this.ctx.scale(this.canvas_scale,this.canvas_scale),this.ctx.clearRect(-this.width/2,-this.height/2,this.width,this.height),this.balls.forEach((function(i){i.draw(t.ctx)})),this.colliders.forEach((function(i){i.draw(t.ctx)})),this.walls.forEach((function(i){i.draw(t.ctx)})),this.cue.draw(this.ctx),this.ctx.scale(1/this.canvas_scale,1/this.canvas_scale)},t.prototype.fitToWindow=function(){window.innerWidth,window.innerHeight,window.innerWidth/window.innerHeight>2?this.canvas_scale=window.innerHeight/this.height:this.canvas_scale=window.innerWidth/this.width;var t=this.height*this.canvas_scale,i=this.width*this.canvas_scale;this.canvas.width=i,this.canvas.height=t,this.ctx.translate(this.canvas.width/2,this.canvas.height/2)},t.prototype.makeBallTriangle=function(){for(var t=5,i=0;i<5;i++){for(var n=t;n>0;n--)this.addBall(new s(new e(6*i-60,6*n+3*i-18)));t-=1}},t.prototype.step=function(t){var i=this;this.inner_width,this.inner_height,this.balls.forEach((function(t){i.walls.forEach((function(i){i.isColliding(t)&&s.applyWallCollision(t,i)}))})),this.findCollisions(),this.processCollisions(),this.balls.forEach((function(t){i.colliders.forEach((function(e){i.isColliding(t,e)&&s.applyStaticCollision(t,e)}))})),this.balls.forEach((function(i){return i.step(t)}))},t.prototype.isColliding=function(t,i){var s=t.radius+i.radius;return!(Math.abs(t.pos.x-i.pos.x)>s||Math.abs(t.pos.y-i.pos.y)>s||e.dist(t.pos,i.pos)>s)},t.prototype.findCollisions=function(){var t=this,i={};this.balls.forEach((function(e){i[e.id]=[],t.balls.forEach((function(s){var n,o;e.id!=s.id&&t.isColliding(e,s)&&((null===(n=i[e.id])||void 0===n?void 0:n.includes(s.id))||(null===(o=i[s.id])||void 0===o?void 0:o.includes(e.id))||(t.collision_buffer.push([e,s]),i[e.id].push(s.id)))}))}))},t.prototype.processCollisions=function(){this.collision_buffer.forEach((function(t){s.applyCollison(t[0],t[1])})),this.collision_buffer=[]},t}(),a=function(){function t(t,i){this.pos=t,this.radius=i}return t.prototype.draw=function(t){t.beginPath(),t.arc(this.pos.x,this.pos.y,this.radius,0,2*Math.PI),t.stroke()},t}(),l=function(){function t(t,i){var e;this.color="black",this.p1=t,this.p2=i,this.mid=this.p1.sub(this.p1.sub(this.p2).multiplyScalor(.5)),this.normal=t.sub(i).normalize(),e=[this.normal.y,-this.normal.x],this.normal.x=e[0],this.normal.y=e[1],console.log(this.normal),console.log(this.p1.sub(this.mid).rotateByVec(this.normal),this.p2.sub(this.mid).rotateByVec(this.normal))}return t.prototype.getNormal=function(){return this.normal},t.prototype.draw=function(t){t.beginPath(),t.moveTo(this.p1.x,this.p1.y),t.lineTo(this.p2.x,this.p2.y),t.strokeStyle=this.color;var i=this.mid.add(this.normal.multiplyScalor(2));t.moveTo(this.mid.x,this.mid.y),t.lineTo(i.x,i.y),t.stroke(),t.strokeStyle="black"},t.prototype.isColliding=function(t){var i=t.pos.sub(this.mid),e=this.p1.sub(this.mid),s=this.p2.sub(this.mid);return i=i.rotateByVec(this.normal),e=e.rotateByVec(this.normal),s=s.rotateByVec(this.normal),i.x+t.radius>e.y&&!(i.x<e.x-t.radius)&&!(i.x>s.x+t.radius)},t}(),r=new o(document.querySelector("canvas"));r.draw(),r.findCollisions();var h=[new e(8,59),new e(-8,59),new e(8,-59),new e(-8,-59),new e(105,59),new e(115,50),new e(-105,-59),new e(-115,-50),new e(105,-59),new e(115,-50),new e(-105,59),new e(-115,50)];[new l(new e(-112,50),new e(-112,-50)),new l(new e(112,-50),new e(112,50)),new l(new e(8,-56),new e(105,-56)),new l(new e(-105,-56),new e(-8,-56)),new l(new e(105,56),new e(8,56)),new l(new e(-8,56),new e(-105,56))].forEach((function(t){r.addWall(t)})),h.forEach((function(t){r.addCollider(new a(t,2.85))})),setInterval((function(){for(var t=0;t<8;t++)r.step(.05)}),8),setInterval((function(){r.draw()}),16)})();